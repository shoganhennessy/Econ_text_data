---
title: "The Ideas.RePEc Listings of Articles in Economics"
author: "Senan Hogan-Hennessy, "
date: "`r format(Sys.time(), '%d %b %Y')`"
output: github_document
---
```{r setup, include=F}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = F, fig.align = 'center')
library(tidyverse)
library(data.table)
latexImg = function(latex, markdown=T){

    link = paste0('http://latex.codecogs.com/gif.latex?',
                  gsub('\\=','%3D',URLencode(latex)))

    # they need to be upper case
    link = gsub("(%..)","\\U\\1",link,perl=TRUE)
    if (!markdown){
        return(link)
    }
    return(paste0('![](',link,')'))
}

```

## WORK IN PROGRESS -- to be finished soon.

The NBER series is a great source of research in our profession, but it isn't the full picture of research in the field.
It is, after all, a listing of working papers which are by definition not yet publications -- though most do go on to be published,
as I noted in the [last post.](https://github.com/shoganhennessy/Econ_text_data/blob/master/Blog_post_exploration/1_NBER_working_papers.md)

```{r, echo = F}
# Load the data on Economists
Economists.data <- fread('../Data/RePEc_data/Economists_data/Economists_repec_data.csv')
# Load the data on published articles
Articles.data <- fread('../Data/RePEc_data/Papers_data/Journal_articles_repec.csv')
# Load Economist-article individual links -- made externally in Python
Economists_articles.links <- fread('../Data/RePEc_data/Economists_data/Economists_articles_repec.csv')
# Load info on journal rankings
Journals.data <- fread('../Data/RePEc_data/Journals_data/Journal_info_repec.csv')
```
Forunately, [Research Papers in Economics (RePEc)'s Ideas](https://ideas.repec.org/) provides a large listing of economics research which I can use as a complement to the NBER listings as it lists information on `r nrow(Economists.data)` economists and `r nrow(Articles.data)` published articles papers -- considering only those in English as of 9 January 2020.

> ''IDEAS is the largest bibliographic database dedicated to Economics and available freely on the Internet. 
> Based on RePEc, it indexes over 3,000,000 items of research, including over 2,700,000 that can be downloaded in full text.''
> 
> -- What is IDEAS?  [Ideas.RePEc.org/](https://ideas.repec.org/) 

`r nrow(Articles.data)` is a huge number of articles to consider, and comparable in size to articles that use the near complete set of publcations.<sup id="a1">[1](#f1)</sup>
RePEc has certain advantages: it is more open and it has a clear link to authors -- and importantly some of their characteristics -- to working and published papers, all within the field of economics.
It is however, a repository only within the economics sphere: citations are only counted among other papers in the database, and not among the universe of publications.

### Citations

For a sanity check, take a look at the most prolific authors in the field by citation count.<sup id="a1">[2](#f2)</sup>
```{r, echo=F, results='asis'}
# The most prolific authors, within these data
## WHo have the most citations, in these data
Economists_citations.data <- Economists_articles.links %>% 
  left_join(select(Economists.data, url, name, 
                   institution, affiliation, degree,) %>% 
              rename(author_name = name, author_url = url), by = 'author_url') %>%
  left_join(rename(Articles.data, article_url = url), by = 'article_url') %>%
  select(author_name, institution, affiliation, degree, 
         title, publication_date, journal_title, citation_count) %>%
  filter(!is.na(citation_count)) %>%
  group_by(author_name) %>%
  summarise(total_citations = sum(citation_count, na.rm = T),
            mean_citations = round(mean(citation_count, na.rm = T)),
            total_articles = n()) %>%
  arrange(-total_citations) 

# SHow the top ten 
Economists_citations.data %>% head(10) %>%
  knitr::kable(format = 'markdown')
```
There are some familiar faces among the names, which is to be expected! The process of assigning is, however, not perfect: citations are assigned from each article to each author equally when there are multiple authors.
Yet [Sarsons (2017)](https://www.aeaweb.org/articles?id=10.1257/aer.p20171126) shows how innapropriate this accounting is by exhibiting the unequal citation rate of return in among economists by gender -- which actually inspired me to work with economics publishing data in the first place!
Call it a point of interest to rank economists by better measures as this project progresses.

Citations are, of course, not evenly distributed across researchers in the field;
the above top ten are at the very top of the field.  But what does the wider distribution look like?
```{r, echo=F, fig.height = 4, fig.width = 7}
# Histogram of authors' citations
Economists_citations.data %>%
  ggplot(aes(x = total_citations)) + theme_bw() +
  geom_histogram(aes(y = ..count..), bins=50, colour='black', fill='#FF6666', alpha=0.2) +
  scale_x_log10(name = 'Total Citations (log scale)',
   breaks = scales::trans_breaks('log10', function(x) 10^x),
   labels = scales::trans_format('log10', scales::math_format(10^.x))) +
  scale_y_continuous(name = 'Author count')
```


Draw a Gini coefficient for citations among authors per year.
```{r, echo=F, fig.height = 3.5, fig.width = 7}
# Dataframe of author citations by year
Author_citations.data <- Economists_articles.links %>% 
  left_join(select(Economists.data, url, name, 
                   institution, affiliation, degree,) %>% 
              rename(author_name = name, author_url = url), by = 'author_url') %>%
  left_join(rename(Articles.data, article_url = url), by = 'article_url') %>%
  select(author_name, institution, affiliation, degree, 
         title, publication_date, journal_title, citation_count) %>%
  filter(!is.na(citation_count)) %>%
  group_by(author_name, publication_date) %>%
  summarise(citation_count = sum(citation_count, na.rm = T)) 


# Gini coefficient for authors' citations, by year
Author_citations.data %>%
  group_by(publication_date) %>%
  summarise(gini_coefficient = reldist::gini(citation_count)) %>%
  filter(publication_date > 1975) %>%
  ggplot(aes(x = publication_date, y = gini_coefficient)) +
  geom_line(colour = 'orange') + theme_bw() +
  scale_x_continuous(name = 'Among Papers in Published in Year', breaks = seq(1975, 2020, by = 5)) +
  scale_y_continuous(name = 'Citations Gini Index (among authors)',
                     breaks = seq(0.3, 0.55, by = 0.05), limits = c(0.3,0.55))
```

Think about whether sharing of publications/work over the internet leads to more or less inequality -> perhaps a better question for the upcoming network analyses.


### The Top 5

Economists aim for the top 5.  READ OVER:

Gibson, J, D L Anderson and J Tressler (2017), "Citations or journal quality: Which is rewarded more in the academic labor market?" Economic Inquiry 55(4): 1945–1965.

Hamermesh, D S (2018), “Citations in economics: Measurement, uses, and impacts,” Journal of Economic Literature 56(1): 115–56.

https://voxeu.org/article/publishing-and-promotion-economics-tyranny-top-five

https://www.nber.org/papers/w25093 

Top Five journals in economics: the American Economic Review, Econometrica,the Journal of Political Economy,the Quarterly Journal of Economics, and the Review of Economic Studies.

> Indeed, serious theoretical and empirical
> work should be conducted to understand this disease better and suggest possible treatments. The problem
> will probably require challenging techniques in applied mechanism design.
> 
> -- [Top5itis, R Serrano (2018)](http://hdl.handle.net/10419/202594)

-> measure citations from making a top 5, and follow on.
^Note that the graph or statistics on that LOOK like some causal identification of the effect, which is not the case yet, so be careful to not use causal language.

SHow how many articles in the top 10.
The accepted top 5 is not the top 5 by total or mean citation count, documented previously in (Anauati et al. 2018 NBER WP 25101).
```{r, echo = F, results='asis'}
Journals_articles.data <- Articles.data %>% 
  filter(!is.na(citation_count) & !is.na(publication_date)) %>%
  group_by(journal_title) %>%
  summarise(mean_citations = round(mean(citation_count, na.rm = T)),
            total_citations = sum(citation_count, na.rm = T),
            total_articles = n()) %>%
  arrange(-total_citations)

Journals_articles.data %>% head(10) %>% 
  knitr::kable(format = 'markdown',
    col.names = c('Journal name', 'Mean citations per article', 'Total citations', 'Count articles'))
```

Draw a line graph for author cumulative citations, years after first publication.
NOTE: attributing citations to year of publication and not year in which a reader cites the previous work in a new publication (which I will consider later in network effects).

Drop off from first publication, a result of many authors with only one or very few publications.
See the difference in the line that only considers author years which contain at least one publication.
```{r, echo = F, fig.height = 4, fig.width = 9}
# create a citation count per economist per year and year since first publication
Author_citation_count.data <- Economists_articles.links %>% 
  left_join(select(Economists.data, url, name, 
                   institution, affiliation, degree,) %>% 
              rename(author_name = name, author_url = url), by = 'author_url') %>%
  left_join(rename(Articles.data, article_url = url), by = 'article_url') %>%
  select(author_name, institution, affiliation, degree, 
         title, publication_date, journal_title, citation_count) %>%
  filter(!is.na(citation_count)) %>%
  group_by(author_name, publication_date) %>%
  summarise(total_citations = sum(citation_count, na.rm = T),
            articles_count = n()) %>%
  arrange(author_name, publication_date) %>% group_by(author_name) %>%
  mutate(since_first = publication_date - first(publication_date))

# Add empty values for years since up to 40 if not listed in data (i.e. didn't publish in that year)
distinct_names <- Author_citation_count.data %>% 
  select(author_name) %>% distinct() %>% pull(author_name)

balanced_data <- matrix(ncol = 2, nrow = 41*length(distinct_names)) %>% data.frame()
colnames(balanced_data) <- c('author_name', 'since_first')

balanced_data$author_name <- distinct_names %>% 
  lapply(function(x) rep(x, 41)) %>% unlist()
balanced_data$since_first <- c(0:40) %>% rep(length(distinct_names))

## add on misisng values and a cumulative count of citatins
Author_cumulative_citations.data <- balanced_data %>% 
  left_join(Author_citation_count.data) %>%
  group_by(author_name) %>%
  replace_na(list(total_citations = 0, articles_count = 0)) %>%
  mutate(publication_date = c(1:n()) - 1 + first(publication_date),
         cum_citations = cumsum(total_citations)) %>%
  filter(publication_date < 2020)

# SHow mean citations every year since first publication
# two lines: one considering only years in which author publishes at least once,
#            one considering all years
Author_cumulative_citations.data %>%
  filter(articles_count > 0) %>% mutate(restricted = 1) %>%
  rbind(Author_cumulative_citations.data) %>% mutate(restricted = !is.na(restricted)) %>%
  group_by(since_first, restricted) %>%
  summarise(mean_citations = mean(total_citations)) %>%
  ggplot(aes(x = since_first, y = mean_citations, colour = restricted)) +
  geom_point() + geom_smooth(span = 0.25, se = F) +
  scale_x_continuous(name = 'Year Since First Publication', breaks = seq(0, 40, by = 5)) +
  scale_y_continuous(name = 'Mean Citations', limits = c(0,120)) + 
  theme_bw() + theme(legend.position = 'right') +
  scale_colour_manual(values = c('chartreuse4', 'darkviolet'),
                        name = 'Restriction',
                        breaks = c(F, T),
                        labels = c('All years', 
                                   '\nAt least one\npublication\nin that year'))
```


#### Event:

Draw a graph for author cumulative citations, years after first publication in a top 5.
Add a line for year after making a top 6-10 (weakly comparable).

NOTE: attributing citations to year of publication and not year in which a reader cites the previous work in a new publication (which I will consider later in network effects).

The pseudo-*event*: publication in a top journal.
```{r, echo = F} 
latexImg('Y_{it}')
```


```{r, echo = F, fig.height = 4.5, fig.width = 9.5}
# Conventional top journals
Top5_journals <- c('American Economic Review',
                   'Journal of Political Economy',
                   'The Quarterly Journal of Economics',
                   'Econometrica',
                   'Review of Economic Studies')

# Comparable next 6.
TopOther_journals <- Journals_articles.data %>% head(10) %>% 
  pull(journal_title) %>% setdiff(Top5_journals)

# Find date of a top 5 and Top other journal for each author
Author_cumulative_citations.data <- Economists_articles.links %>% 
  left_join(select(Economists.data, url, name, 
                   institution, affiliation, degree,) %>% 
              rename(author_name = name, author_url = url), by = 'author_url') %>%
  left_join(rename(Articles.data, article_url = url), by = 'article_url') %>%
  select(author_name, institution, affiliation, degree, 
         title, publication_date, journal_title, citation_count) %>%
  mutate(top5 = as.numeric(journal_title %in% Top5_journals),
         topother = as.numeric(journal_title %in% TopOther_journals)) %>%
  group_by(author_name, publication_date) %>%
  summarise(top5_count = sum(top5),
            topother_count = sum(topother)) %>%
  filter(top5_count + topother_count > 0) %>%
  right_join(Author_cumulative_citations.data) %>%
  replace_na(list(top5_count = 0, topother_count = 0))
  
# Top5_since
Top5_since.data <- Author_cumulative_citations.data %>%
  mutate(top5 = as.numeric(top5_count > 0)) %>%
  arrange(author_name, publication_date) %>%
  group_by(author_name) %>% filter(max(top5) > 0) %>%
  mutate(since_first_top5 = publication_date - min(((top5!=1)+1) * publication_date)) %>%
  select(author_name, publication_date, top5, since_first_top5, total_citations) %>%
  arrange(author_name, since_first_top5)

# Top other since
Topother_since.data <- Author_cumulative_citations.data %>%
  mutate(topother = as.numeric(topother_count > 0)) %>%
  group_by(author_name) %>% filter(max(topother) > 0) %>%
  mutate(since_first_topother = publication_date - min(((topother!=1)+1) * publication_date)) %>%
  select(author_name, publication_date, topother, since_first_topother, total_citations, cum_citations)

# Draw event study style graph, for the top5
coefficient_range <- c(min(Top5_since.data$since_first_top5):
                       max(Top5_since.data$since_first_top5))

Top5.eventstudy <- Top5_since.data %>%
  filter(total_citations > 0) %>%
  lm(log(total_citations) ~ as.factor(since_first_top5), data = .) %>%
  broom::tidy() %>% slice(-1) %>% 
  mutate(coefficient = as.numeric(str_extract(term, '[^)]+$'))) %>%
  filter(abs(coefficient) < 21)  %>%
  mutate(before = ifelse(coefficient < 0 , estimate, NA),
         after  = ifelse(0 <= coefficient, estimate, NA)) %>%
  ggplot(aes(x = coefficient)) + 
  geom_point(aes(y = estimate)) + 
  geom_smooth(aes(y = estimate), se = F, colour = 'blue', span = 0.5, alpha = 0.2) +
  geom_smooth(aes(y = before), method = 'lm', se = F, colour = 'red') +
  geom_smooth(aes(y = after ), method = 'lm', se = F, colour = 'red') +
  scale_x_continuous(name = 'Year to Publication', breaks = seq(-20, 20, by = 5)) +
  scale_y_continuous(name = 'Coefficient Estimate', limits = c(0.2,0.8), breaks = seq(0.2,0.8, by = 0.1)) +
  theme_bw() + ggtitle('Log Citations by year to author first\ntop 5 publication') +
  theme(plot.title = element_text(hjust = 0.5))

# Draw event study style graph, for the top other
coefficient_range <- c(min(Topother_since.data$since_first_topother):
                       max(Topother_since.data$since_first_topother))

Topother.eventstudy <- Topother_since.data %>%
  filter(total_citations > 0) %>%
  lm(log(total_citations) ~ as.factor(since_first_topother), data = .) %>%
  broom::tidy() %>% slice(-1) %>% 
  mutate(coefficient = as.numeric(str_extract(term, '[^)]+$'))) %>%
  filter(abs(coefficient) < 21) %>%
  mutate(before = ifelse(coefficient < 0 , estimate, NA),
         after  = ifelse(0 <= coefficient, estimate, NA)) %>%
  ggplot(aes(x = coefficient)) + 
  geom_point(aes(y = estimate)) + 
  geom_smooth(aes(y = estimate), se = F, colour = 'blue', span = 0.5, alpha = 0.2) +
  geom_smooth(aes(y = before), method = 'lm', se = F, colour = 'red') +
  geom_smooth(aes(y = after ), method = 'lm', se = F, colour = 'red') +
  scale_x_continuous(name = 'Year to Publication', breaks = seq(-20, 20, by = 5)) +
  scale_y_continuous(name = '', limits = c(0.2,0.8), breaks = seq(0.2,0.8, by = 0.1)) + 
  theme_bw() + ggtitle('Log Citations by year to author first\ntop other publication') +
  theme(plot.title = element_text(hjust = 0.5))

# Show both event graphs
gridExtra::grid.arrange(Top5.eventstudy, Topother.eventstudy, nrow = 1)
```


### Conclusion: 

Describe data set and opportunity to measure economics publication *outcomes*.


**Next up:** Looking at inclusion in the *NBER family*.

***
<b id="f1">1</b> [Angrist et al. (2017)](https://www.nber.org/papers/w23698) link Econlit and Web of Science for similar coverage, for example.[↩](#a1)

<b id="f2">2</b> Again, note that this citation count is not the same as that in the universe of academic publications or Google Scholar, it is a count of the citations within the RePEc listings so a measure of citations within only this large coverage of the field.[↩](#a1)

***
## References
1. Angrist, Joshua, et al. Inside job or deep impact? Using extramural citations to assess economic scholarship. No. w23698. National Bureau of Economic Research, 2017.
2. Sarsons, Heather. Recognition for group work: Gender differences in academia. American Economic Review 107.5 (2017): 141-45.
3. Serrano, Roberto. Top5itis. No. 2018-2. Working Paper, 2018.
